<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="_project.yaml" />
  <meta name="book_path" value="_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Source: workbox-build/src/lib/utils/runtime-caching-converter.js</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: workbox-build/src/lib/utils/runtime-caching-converter.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>&#x27;use strict&#x27;;

const errors &#x3D; require(&#x27;../errors&#x27;);

/**
 * Given a set of options that configures &#x60;sw-toolbox&#x60;&#x27;s behavior, convert it
 * into a string that would configure equivalent &#x60;workbox-sw&#x60; behavior.
 *
 * @param {Object} options See
 *        https://googlechrome.github.io/sw-toolbox/api.html#options
 * @return {String} A JSON string representing the equivalent options.
 */
function getOptionsString(options) {
  const cacheOptions &#x3D; options.cache || {};
  // Start with a base of a few properties that need to be renamed, as well
  // as copying over all the other source properties as-is.
  const effectiveOptions &#x3D; Object.assign({
    cacheName: cacheOptions.name,
  }, options);

  // Only create the cacheExpiration object if either maxEntries or
  // maxAgeSeconds is set.
  if (cacheOptions.maxEntries || cacheOptions.maxAgeSeconds) {
    effectiveOptions.cacheExpiration &#x3D;
      Object.assign(effectiveOptions.cacheExpiration || {}, {
        maxEntries: cacheOptions.maxEntries,
        maxAgeSeconds: cacheOptions.maxAgeSeconds,
      });
  }

  // Everything should be copied to the corresponding new option names at this
  // point, so set the old-style &#x60;cache&#x60; property to undefined so that it
  // doesn&#x27;t show up in the JSON output.
  effectiveOptions.cache &#x3D; undefined;

  // JSON.stringify() will automatically omit any properties that are set to
  // undefined values.
  return JSON.stringify(effectiveOptions, null, 2);
}

module.exports &#x3D; (runtimeCaching) &#x3D;&gt; {
  runtimeCaching &#x3D; runtimeCaching || [];
  return runtimeCaching.map((entry) &#x3D;&gt; {
    const method &#x3D; entry.method || &#x27;GET&#x27;;

    if (!entry.urlPattern) {
      throw new Error(errors[&#x27;urlPattern-is-required&#x27;]);
    }

    if (!entry.handler) {
      throw new Error(errors[&#x27;handler-is-required&#x27;]);
    }

    // urlPattern might be either a string or a RegExp object.
    // If it&#x27;s a string, it needs to be quoted. If it&#x27;s a RegExp, it should
    // be used as-is.
    const matcher &#x3D; typeof entry.urlPattern &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ?
      &#x60;&#x27;${entry.urlPattern}&#x27;&#x60; :
      entry.urlPattern;

    if (typeof entry.handler &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
      const handlerName &#x3D; entry.handler &#x3D;&#x3D;&#x3D; &#x27;fastest&#x27; ?
        &#x27;staleWhileRevalidate&#x27; :
        entry.handler;

      const optionsString &#x3D; getOptionsString(entry.options || {});

      const strategyString &#x3D;
        &#x60;workboxSW.strategies.${handlerName}(${optionsString})&#x60;;

      return &#x60;workboxSW.router.registerRoute(&#x60; +
        &#x60;${matcher}, ${strategyString}, &#x27;${method}&#x27;);&#x60;;
    } else if (typeof entry.handler &#x3D;&#x3D;&#x3D; &#x27;function&#x27;) {
      return &#x60;workboxSW.router.registerRoute(&#x60; +
        &#x60;${matcher}, ${entry.handler}, &#x27;${method}&#x27;);&#x60;;
    }
  }).filter((entry) &#x3D;&gt; Boolean(entry)); // Remove undefined map() return values.
};
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>