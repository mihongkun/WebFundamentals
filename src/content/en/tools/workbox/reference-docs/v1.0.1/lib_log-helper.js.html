<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="_project.yaml" />
  <meta name="book_path" value="_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Source: lib/log-helper.js</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: lib/log-helper.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>/*
 Copyright 2016 Google Inc. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/

/* eslint-disable no-console */

import LogGroup from &#x27;./log-group&#x27;;
import environment from &#x27;./environment&#x27;;

self.workbox &#x3D; self.workbox || {};
self.workbox.LOG_LEVEL &#x3D; self.workbox.LOG_LEVEL || {
  none: -1,
  verbose: 0,
  debug: 1,
  warn: 2,
  error: 3,
};

const LIGHT_GREY &#x3D; &#x60;#bdc3c7&#x60;;
const DARK_GREY &#x3D; &#x60;#7f8c8d&#x60;;
const LIGHT_GREEN &#x3D; &#x60;#2ecc71&#x60;;
const LIGHT_YELLOW &#x3D; &#x60;#f1c40f&#x60;;
const LIGHT_RED &#x3D; &#x60;#e74c3c&#x60;;
const LIGHT_BLUE &#x3D; &#x60;#3498db&#x60;;

/**
 * A class that will only log given the current log level
 * defined by the developer.
 *
 * Define custom log level by setting &#x60;self.workbox.logLevel&#x60;.
 *
 * @example
 *
 * self.workbox.logLevel &#x3D; self.workbox.LOG_LEVEL.verbose;
 *
 * @private
 */
class LogHelper {
  /**
   * LogHelper constructor.
   */
  constructor() {
    this._defaultLogLevel &#x3D; environment.isDevBuild() ?
      self.workbox.LOG_LEVEL.debug :
      self.workbox.LOG_LEVEL.warn;
  }

  /**
   * The most verbose log level.
   *
   * @param {Object} options The options of the log.
   */
  log(options) {
    this._printMessage(self.workbox.LOG_LEVEL.verbose, options);
  }

  /**
   * Useful for logs that are more exceptional that log()
   * but not severe.
   *
   * @param {Object} options The options of the log.
   */
  debug(options) {
    this._printMessage(self.workbox.LOG_LEVEL.debug, options);
  }

  /**
   * Warning messages.
   *
   * @param {Object} options The options of the log.
   */
  warn(options) {
    this._printMessage(self.workbox.LOG_LEVEL.warn, options);
  }

  /**
   * Error logs.
   *
   * @param {Object} options The options of the log.
   */
  error(options) {
    this._printMessage(self.workbox.LOG_LEVEL.error, options);
  }

  /**
   * Method to print to the console.
   * @param {number} logLevel
   * @param {Object} logOptions
   */
  _printMessage(logLevel, logOptions) {
    if (!this._shouldLogMessage(logLevel, logOptions)) {
      return;
    }

    const logGroups &#x3D; this._getAllLogGroups(logLevel, logOptions);
    logGroups.print();
  }

  /**
   * Print a user friendly log to the console.
   * @param  {numer} logLevel A number from self.workbox.LOG_LEVEL
   * @param  {Object} logOptions Arguments to print to the console
   * @return {LogGroup} Returns a log group to print to the console.
   */
  _getAllLogGroups(logLevel, logOptions) {
    const topLogGroup &#x3D; new LogGroup({
      isPrimary: true,
      title: &#x27;workbox log.&#x27;,
    });

    const primaryMessage &#x3D; this._getPrimaryMessageDetails(logLevel, logOptions);
    topLogGroup.addLog(primaryMessage);

    if (logOptions.error) {
      const errorMessage &#x3D; {
        message: logOptions.error,
        logFunc: console.error,
      };
      topLogGroup.addLog(errorMessage);
    }

    const extraInfoGroup &#x3D; new LogGroup({title: &#x27;Extra Information.&#x27;});
    if (logOptions.that &amp;amp;&amp;amp; logOptions.that.constructor &amp;amp;&amp;amp;
      logOptions.that.constructor.name) {
      const className &#x3D; logOptions.that.constructor.name;
      extraInfoGroup.addLog(
        this._getKeyValueDetails(&#x27;class&#x27;, className)
      );
    }

    if (logOptions.data) {
      if (typeof logOptions.data &#x3D;&#x3D;&#x3D; &#x27;object&#x27; &amp;amp;&amp;amp;
        !(logOptions.data instanceof Array)) {
        Object.keys(logOptions.data).forEach((keyName) &#x3D;&gt; {
          extraInfoGroup.addLog(
            this._getKeyValueDetails(keyName, logOptions.data[keyName])
          );
        });
      } else {
        extraInfoGroup.addLog(
          this._getKeyValueDetails(&#x27;additionalData&#x27;, logOptions.data)
        );
      }
    }

    topLogGroup.addChildGroup(extraInfoGroup);

    return topLogGroup;
  }

  /**
   * This is a helper function to wrap key value pairss to a colored key
   * value string.
   * @param  {string} key
   * @param  {string} value
   * @return {Object} The object containing a message, color and Arguments
   * for the console.
   */
  _getKeyValueDetails(key, value) {
    return {
      message: &#x60;%c${key}: &#x60;,
      colors: [&#x60;color: ${LIGHT_BLUE}&#x60;],
      args: value,
    };
  }

  /**
   * Helper method to color the primary message for the log
   * @param  {number} logLevel   One of self.workbox.LOG_LEVEL
   * @param  {Object} logOptions Arguments to print to the console
   * @return {Object} Object containing the message and color info to print.
   */
  _getPrimaryMessageDetails(logLevel, logOptions) {
    let logLevelName;
    let logLevelColor;
    switch (logLevel) {
      case self.workbox.LOG_LEVEL.verbose:
        logLevelName &#x3D; &#x27;Info&#x27;;
        logLevelColor &#x3D; LIGHT_GREY;
        break;
      case self.workbox.LOG_LEVEL.debug:
        logLevelName &#x3D; &#x27;Debug&#x27;;
        logLevelColor &#x3D; LIGHT_GREEN;
        break;
      case self.workbox.LOG_LEVEL.warn:
        logLevelName &#x3D; &#x27;Warn&#x27;;
        logLevelColor &#x3D; LIGHT_YELLOW;
        break;
      case self.workbox.LOG_LEVEL.error:
        logLevelName &#x3D; &#x27;Error&#x27;;
        logLevelColor &#x3D; LIGHT_RED;
        break;
    }

    let primaryLogMessage &#x3D; &#x60;%cðŸ”§ %c[${logLevelName}]&#x60;;
    const primaryLogColors &#x3D; [
      &#x60;color: ${LIGHT_GREY}&#x60;,
      &#x60;color: ${logLevelColor}&#x60;,
    ];

    let message;
    if(typeof logOptions &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
      message &#x3D; logOptions;
    } else if (logOptions.message) {
      message &#x3D; logOptions.message;
    }

    if (message) {
      message &#x3D; message.replace(/\s+/g, &#x27; &#x27;);
      primaryLogMessage +&#x3D; &#x60;%c ${message}&#x60;;
      primaryLogColors.push(&#x60;color: ${DARK_GREY}; font-weight: normal&#x60;);
    }

    return {
      message: primaryLogMessage,
      colors: primaryLogColors,
    };
  }

  /**
   * Test if the message should actually be logged.
   * @param {number} logLevel The level of the current log to be printed.
   * @param {Object|String} logOptions The options to log.
   * @return {boolean} Returns true of the message should be printed.
   */
  _shouldLogMessage(logLevel, logOptions) {
    if (!logOptions) {
      return false;
    }

    let minValidLogLevel &#x3D; this._defaultLogLevel;
    if (self &amp;amp;&amp;amp; self.workbox &amp;amp;&amp;amp; typeof self.workbox.logLevel &#x3D;&#x3D;&#x3D; &#x27;number&#x27;) {
      minValidLogLevel &#x3D; self.workbox.logLevel;
    }

    if (minValidLogLevel &#x3D;&#x3D;&#x3D; self.workbox.LOG_LEVEL.none ||
      logLevel &amp;lt; minValidLogLevel) {
      return false;
    }

    return true;
  }
}

export default new LogHelper();
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>