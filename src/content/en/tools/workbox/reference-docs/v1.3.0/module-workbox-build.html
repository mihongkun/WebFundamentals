<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="_project.yaml" />
  <meta name="book_path" value="_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Module: workbox-build</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1><small></small><span class="symbol-name">workbox-build</span></h1>
            <div class="symbol-detail-labels"><span class="label label-kind"><small>module</small></span></div>
            <p>
              <h1 id="workbox-build">workbox-build</h1>
            </p>
            <p>
              <p>This Node module can be used to generate a list of assets that should be precached in a service worker, generating a hash that can be used to intelligently update a cache when the service worker is updated.</p>
            </p>
            <p>
              <p>This module will use glob patterns to find assets in a given directory and use the resulting URL and hash data for one of the follow uses:</p>
            </p>
            <ol>
              <li>Generate a complete service worker with precaching and some basic configurable options. See
                <a href="module-workbox-build.html#.generateSW">generateSW()</a>.</li>
              <li>Inject a manifest into an existing service worker. This allows you to control your own service worker while still taking advantage of
                <a href="module-workbox-sw.WorkboxSW.html#precache">workboxSW.precache()</a> logic. See <a href="module-workbox-build.html#.injectManifest">injectManifest()</a>.</li>
              <li>Generate a manifest file. This is useful if you want to read in the urls and revision details via an import script or ES2015 module import. See <a href="module-workbox-build.html#.generateFileManifest">generateFileManifest()</a>.</li>
              <li>Get a JS object of the manifest details. Can be used in a build process if you want to inject the manifest into a file or template yourself. See <a href="module-workbox-build.html#.getFileManifestEntries">getFileManifestEntries()</a>.</li>
            </ol>
          </header>
          <section>
            <h2>Methods</h2>
            <section>
              <h3 id=".generateFileManifest" class="symbol-name">generateFileManifest</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> generateFileManifest(input)&nbsp;returns&nbsp;Promise</p>
              <p>This method will generate a file manifest that can be used in a service worker to precache assets.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise</code>&nbsp;
                    <p>The returned promise resolves once the manifest file has been generated.</p>
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;Generate a build manifest of static assets, which can
used with a service worker.&lt;/caption&gt;
const swBuild &#x3D; require(&#x27;workbox-build&#x27;);

swBuild.generateFileManifest({
  manifestDest: &#x27;./build/manifest.js&#x27;
  globDirectory: &#x27;./build/&#x27;,
  globPatterns: [&#x27;**\/*.{html,js,css}&#x27;],
  globIgnores: [&#x27;admin.html&#x27;],
  format: &#x27;iife&#x27;, // alternatively, use &#x27;es&#x27;
})
.then(() &#x3D;&gt; {
  console.log(&#x27;Build Manifest generated.&#x27;);
});</code></pre>
                </div>
              </section>
              <h3 id=".generateSW" class="symbol-name">generateSW</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> generateSW(input)&nbsp;returns&nbsp;Promise</p>
              <p>This method will generate a working service worker with an inlined file manifest.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise</code>&nbsp;
                    <p>Resolves once the service worker has been generated with a precache list.</p>
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;Generate a service worker with precaching support.
&lt;/caption&gt;
const swBuild &#x3D; require(&#x27;workbox-build&#x27;);

swBuild.generateSW({
  swDest: &#x27;./build/sw.js&#x27;,
  globDirectory: &#x27;./build/&#x27;,
  globPatterns: [&#x27;**\/*.{html,js,css}&#x27;],
  globIgnores: [&#x27;admin.html&#x27;],
  templatedUrls: {
    &#x27;/shell&#x27;: [&#x27;shell.hbs&#x27;, &#x27;main.css&#x27;, &#x27;shell.css&#x27;],
  },
})
.then(() &#x3D;&gt; {
  console.log(&#x27;Service worker generated.&#x27;);
});</code></pre>
                </div>
              </section>
              <h3 id=".getFileManifestEntries" class="symbol-name">getFileManifestEntries</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> getFileManifestEntries(input)&nbsp;returns&nbsp;Promise containing Array of ManifestEntry</p>
              <p>To get a list of files and revision details that can be used to ultimately precache assets in a service worker.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise containing Array of ManifestEntry</code>&nbsp;
                    <p>An array of ManifestEntries which will include a url and revision parameter.</p>
                  </p>
                </dd>
              </dl>
              <h3 id=".injectManifest" class="symbol-name">injectManifest</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> injectManifest(input)&nbsp;returns&nbsp;Promise</p>
              <p>This method will read an existing service worker file and replace an empty precache() call, like: <code>.precache([])</code>, and replace the array with an array of assets to precache. This allows the service worker to efficiently cache
                assets for offline use.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>input</p>
                      </td>
                      <td>
                        <p class="details-table-types">Object</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Promise</code>&nbsp;
                    <p>Resolves once the service worker has been written with the injected precache list.</p>
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Example
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;Generate a build manifest of static assets, which could
then be used with a service worker.&lt;/caption&gt;
const swBuild &#x3D; require(&#x27;workbox-build&#x27;);

swBuild.injectManifest({
  globDirectory: &#x27;./build/&#x27;,
  globPatterns: [&#x27;**\/*.{html,js,css}&#x27;],
  globIgnores: [&#x27;admin.html&#x27;],
  swSrc: &#x27;./src/sw.js&#x27;,
  swDest: &#x27;./build/sw.js&#x27;,
})
.then(() &#x3D;&gt; {
  console.log(&#x27;Build Manifest generated.&#x27;);
});</code></pre>
                </div>
              </section>
            </section>
            <h2>Abstract types</h2>
            <section>
              <h3 id=".ManifestEntry" class="symbol-name">ManifestEntry</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature">Object</p>
              <section>
                <h4>Properties</h4>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>url</p>
                      </td>
                      <td>
                        <p class="details-table-types">String</p>
                        <p>The URL to the asset in the manifest.</p>
                      </td>
                    </tr>
                    <tr>
                      <td class="details-table-name">
                        <p>revision</p>
                      </td>
                      <td>
                        <p class="details-table-types">String</p>
                        <p>The revision details for the file. This is a hash generated by node based on the file contents.</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
              </dl>
              <h3 id=".ManifestTransform" class="symbol-name">ManifestTransform</h3>
              <div class="symbol-detail-labels"><span class="label label-static"><small>static</small></span></div>
              <p class="type-signature"> ManifestTransform(manifestEntries)&nbsp;returns&nbsp;Array of ManifestEntry</p>
              <p>A <code>ManifestTransform</code> function can be used to modify the modify the <code>url</code> or
                <code>revision</code> properties of some or all of the ManifestEntries in the manifest.</p>
              <p>Deleting the <code>revision</code> property of an entry will cause the corresponding <code>url</code> to be precached without cache-busting parameters applied, which is to say, it implies that the URL itself contains proper versioning info.
                If the <code>revision</code> property is present, it must be set to a string.</p>
              <section>
                <table class="function param responsive">
                  <tr>
                    <th colspan="2">
                      <h4>Parameter</h4>
                    </th>
                  </tr>
                  <tbody>
                    <tr>
                      <td class="details-table-name">
                        <p>manifestEntries</p>
                      </td>
                      <td>
                        <p class="details-table-types">Array of ManifestEntry</p>
                        <p>The full array of entries, prior to the current transformation.</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </section>
              <dl class="dl-compact">
                <dt>Returns</dt>
                <dd>
                  <p><code>Array of ManifestEntry</code>&nbsp;
                    <p>The array of entries with the transformation applied.
                    </p>
                  </p>
                </dd>
              </dl>
              <section>
                <h4>
                  Examples
                </h4>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;A transformation that prepended the origin of a CDN for any
URL starting with &#x27;/assets/&#x27; could be implemented as:&lt;/caption&gt;

const cdnTransform &#x3D; (manifestEntries) &#x3D;&gt; manifestEntries.map(entry &#x3D;&gt; {
  const cdnOrigin &#x3D; &#x27;https://example.com&#x27;;
  if (entry.url.startsWith(&#x27;/assets/&#x27;)) {
    entry.url &#x3D; cdnOrigin + entry.url;
  }
  return entry;
});</code></pre>
                </div>
                <div>
                  <pre class="prettyprint"><code>&lt;caption&gt;A transformation that removes the revision field when the
URL contains an 8-character hash surrounded by &#x27;.&#x27;, indicating that it
already contains revision information:&lt;/caption&gt;

const removeRevisionTransform &#x3D; (manifestEntries) &#x3D;&gt; {
  return manifestEntries.map(entry &#x3D;&gt; {
    const hashRegExp &#x3D; /\.\w{8}\./;
    if (entry.url.match(hashRegExp)) {
      delete entry.revision;
    }
    return entry;
  });
};</code></pre>
                </div>
              </section>
            </section>
          </section>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>