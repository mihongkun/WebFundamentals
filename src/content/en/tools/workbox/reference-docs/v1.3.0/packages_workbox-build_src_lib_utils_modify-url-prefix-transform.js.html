<!DOCTYPE html>
<html devsite>

<head>
  <meta name="project_path" value="_project.yaml" />
  <meta name="book_path" value="_book.yaml" />
  <meta name="gtm_var" data-key="docType" data-value="reference">
  <title>Source: packages/workbox-build/src/lib/utils/modify-url-prefix-transform.js</title>
  <link href="jsdoc.css" rel="stylesheet">
</head>

<body>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: packages/workbox-build/src/lib/utils/modify-url-prefix-transform.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>&#x27;use strict&#x27;;

const errors &#x3D; require(&#x27;../errors&#x27;);

/**
 * Escaping user input to be treated as a literal string within a regular
 * expression can be accomplished by simple replacement.
 *
 * From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions
 *
 * @param  {string} string The string to be used as part of a regular
 *                         expression
 * @return {string}        A string that is safe to use in a regular
 *                         expression.
 */
const escapeRegExp &#x3D; (string) &#x3D;&gt; {
  return string.replace(/[.*+?^${}()|[\]\\]/g, &#x27;\\$&amp;amp;&#x27;);
};

module.exports &#x3D; (modifyUrlPrefix) &#x3D;&gt; {
  if (!modifyUrlPrefix ||
      typeof modifyUrlPrefix !&#x3D;&#x3D; &#x27;object&#x27; ||
      Array.isArray(modifyUrlPrefix)) {
    throw new Error(errors[&#x27;modify-url-prefix-bad-prefixes&#x27;]);
  }

  // If there are no entries in modifyUrlPrefix, just return an identity
  // function as a shortcut.
  if (Object.keys(modifyUrlPrefix).length &#x3D;&#x3D;&#x3D; 0) {
    return (entry) &#x3D;&gt; entry;
  }

  Object.keys(modifyUrlPrefix).forEach((key) &#x3D;&gt; {
    if (typeof modifyUrlPrefix[key] !&#x3D;&#x3D; &#x27;string&#x27;) {
      throw new Error(errors[&#x27;modify-url-prefix-bad-prefixes&#x27;]);
    }
  });

  // Escape the user input so it&#x27;s safe to use in a regex.
  const safeModifyUrlPrefixes &#x3D; Object.keys(modifyUrlPrefix).map(escapeRegExp);
  // Join all the &#x60;modifyUrlPrefix&#x60; keys so a single regex can be used.
  const prefixMatchesStrings &#x3D; safeModifyUrlPrefixes.join(&#x27;|&#x27;);
  // Add &#x60;^&#x60; to the front the prefix matches so it only matches the start of
  // a string.
  const modifyRegex &#x3D; new RegExp(&#x60;^(${prefixMatchesStrings})&#x60;);

  return (manifest) &#x3D;&gt; manifest.map((entry) &#x3D;&gt; {
    if (typeof entry.url !&#x3D;&#x3D; &#x27;string&#x27;) {
      throw new Error(errors[&#x27;manifest-entry-bad-url&#x27;]);
    }

    entry.url &#x3D; entry.url.replace(modifyRegex, (match) &#x3D;&gt; {
      return modifyUrlPrefix[match];
    });

    return entry;
  });
};
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
</body>

</html>